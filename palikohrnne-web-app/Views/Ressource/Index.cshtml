@model List<Ressource>
@{
    ViewData["Title"] = "Index";
    var idCategorie = ViewContext.RouteData.Values["id"];
}
@section Styles{
    <link href="~/css/ressource-list.css" rel="stylesheet" />
}
<div class="toolbar">
    <a asp-action="PublierRessource"
       asp-route-id="@idCategorie"
       class="btn btn-success">
        Publier une ressource dans cette catégorie
    </a>
    <span class="ml-5">Méthode de tri : </span>
    <div class="btn-group ml-3" role="group" aria-label="Basic outlined example">
        <a asp-action="Index"
           asp-route-id="@idCategorie" 
           asp-route-filtre="recents"
           class="btn btn-outline-success @(ViewBag.Filtre == "recents" || String.IsNullOrEmpty(ViewBag.Filtre)? "active" : "")">
            Les plus récent
        </a>
        <a asp-action="Index"
           asp-route-id="@idCategorie"
           asp-route-filtre="reponsesDesc"
           class="btn btn-outline-success @(ViewBag.Filtre == "reponsesDesc"? "active" : "")">
            Le plus de réponses
        </a>
        <a asp-action="Index"
           asp-route-id="@idCategorie"
           asp-route-filtre="reponsesAsc"
           class="btn btn-outline-success @(ViewBag.Filtre == "reponsesAsc"? "active" : "")">
            Le moins de réponses
        </a>
    </div>
</div>
<div class="posts-container">
    <table>
        <thead class="table-header">
            <tr>
                <th></th>
                <th>TITRE/AUTEUR</th>
                <th>RÉPONSES/AFFICHAGES</th>
                <th class="last-message">DERNIER MESSAGE</th>
            </tr>
        </thead>
        <tbody class="table-body">
            @foreach (var ressource in Model)
            {
                <tr>
                    <td class="logo">
                        <i class="fa fa-file"></i>
                    </td>
                    <td class="titre-td">
                        <div class="titre">
                            <span><a asp-action="Details" asp-route-id="@ressource.ID">@ressource.Titre</a></span>
                            <span class="auteur">
                                @ressource.Citoyen.Pseudo,
                                @ressource.CreatedAt.ToString("dd/MM/yyyy, HH:mm")
                            </span>
                            <div class="tags">
                                @foreach (var tag in ressource.Tags)
                                {
                                    <span class="badge bg-success text-light">@tag.Nom</span>
                                }
                            </div>
                        </div>
                    </td>
                    <td class="stats-td">
                        <div class="stats">
                            <span>Réponses: @ressource.Commentaires.Count</span>
                            <span>Affichages: @ressource.Vues</span>
                        </div>

                    </td>
                    <td class="last-message">
                        @ressource.Commentaires.LastOrDefault()?.CreatedAt.ToLocalTime().Humanize()
                        <span style="color:forestgreen">@ressource.Commentaires.LastOrDefault()?.CreatedAt.ToString("hh:mm")</span>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>